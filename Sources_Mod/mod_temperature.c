//==================================================================================
//| 文件名称 | 双缓冲切换
//|----------|----------------------------------------------------------------------
//| 文件功能 | 
//|----------|----------------------------------------------------------------------
//| 输入参数 | 无
//|----------|----------------------------------------------------------------------
//| 返回参数 | 无
//==================================================================================
#include "mod_temperature.h"
#include "Pub_Nihe.h"
//---------------------------------TEC温度测量数据------------------------------//
const FP32 f_TecTR_Temp[91]={
-20,
-19,
-18,
-17,
-16,
-15,
-14,
-13,
-12,
-11,
-10,
-9,
-8,
-7,
-6,
-5,
-4,
-3,
-2,
-1,
0,
1,
2,
3,
4,
5,
6,
7,
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21,
22,
23,
24,
25,
26,
27,
28,
29,
30,
31,
32,
33,
34,
35,
36,
37,
38,
39,
40,
41,
42,
43,
44,
45,
46,
47,
48,
49,
50,
51,
52,
53,
54,
55,
56,
57,
58,
59,
60,
61,
62,
63,
64,
65,
66,
67,
68,
69,
70 
};

const FP32 f_TecTR_Vlot[91]={
2.277361157,
2.264757154,
2.25162378,
2.237952233,
2.223734593,
2.2089639,
2.193634233,
2.177740786,
2.161279942,
2.144249344,
2.126647963,
2.108476157,
2.089735731,
2.070429987,
2.050563763,
2.030143472,
2.009177126,
1.987674352,
1.965646404,
1.943106154,
1.920068081,
1.896548246,
1.872564257,
1.848135221,
1.823281688,
1.798025582,
1.772390124,
1.746399743,
1.720079981,
1.693457389,
1.666559412,
1.639414275,
1.612050858,
1.58449857,
1.556787219,
1.528946881,
1.501007766,
1.473000092,
1.444953952,
1.41689919,
1.388865281,
1.360881209,
1.332975365,
1.305175436,
1.277508313,
1.25,
1.222675538,
1.195558932,
1.168673088,
1.142039763,
1.115679519,
1.089611691,
1.063854356,
1.038424324,
1.013337121,
0.988606991,
0.964246902,
0.940268558,
0.916682416,
0.893497716,
0.870722502,
0.848363665,
0.826426973,
0.80491712,
0.783837762,
0.763191568,
0.74298027,
0.723204705,
0.703864874,
0.684959987,
0.666488513,
0.648448234,
0.630836295,
0.613649248,
0.596883105,
0.580533382,
0.564595145,
0.549063053,
0.5339314,
0.519194157,
0.504845006,
0.49087738,
0.477284494,
0.464059383,
0.451194925,
0.438683874,
0.426518888,
0.414692549,
0.40319739,
0.392025915,
0.381170617,
};

//---------------------------------电路板温度测量数据------------------------------//
const FP32 f_PcbTR_Temp[91]={
-20,
-19,
-18,
-17,
-16,
-15,
-14,
-13,
-12,
-11,
-10,
-9,
-8,
-7,
-6,
-5,
-4,
-3,
-2,
-1,
0,
1,
2,
3,
4,
5,
6,
7,
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21,
22,
23,
24,
25,
26,
27,
28,
29,
30,
31,
32,
33,
34,
35,
36,
37,
38,
39,
40,
41,
42,
43,
44,
45,
46,
47,
48,
49,
50,
51,
52,
53,
54,
55,
56,
57,
58,
59,
60,
61,
62,
63,
64,
65,
66,
67,
68,
69,
70 
};

const FP32 f_PcbTR_Vlot[91]={
2.213301719,
2.199497794,
2.185238718,
2.170522515,
2.155348063,
2.13971513,
2.123624408,
2.10707754,
2.090077148,
2.072626857,
2.054731308,
2.036396175,
2.017628171,
1.998435053,
1.978825616,
1.95880969,
1.938398124,
1.917602765,
1.896436439,
1.874912916,
1.853046875,
1.830853865,
1.808350258,
1.7855532,
1.762480553,
1.739150837,
1.715583168,
1.691797192,
1.667813014,
1.643651131,
1.619332356,
1.594877744,
1.570308523,
1.545646011,
1.520911551,
1.496126431,
1.471311818,
1.446488685,
1.421677745,
1.396899388,
1.37217362,
1.347520004,
1.32295761,
1.29850496,
1.274179989,
1.25,
1.225981629,
1.202140813,
1.178492765,
1.155051946,
1.131832055,
1.108846005,
1.086105922,
1.063623135,
1.041408174,
1.019470777,
0.997819885,
0.976463663,
0.955409501,
0.934664035,
0.914233158,
0.894122045,
0.874335167,
0.854876319,
0.83574864,
0.81695464,
0.798496224,
0.780374721,
0.762590909,
0.745145045,
0.72803689,
0.711265738,
0.694830445,
0.678729456,
0.662960828,
0.647522263,
0.632411131,
0.617624494,
0.603159131,
0.589011566,
0.575178085,
0.561654762,
0.54843748,
0.53552195,
0.52290373,
0.510578246,
0.498540808,
0.486786625,
0.475310825,
0.464108463,
0.453174543,
}; 

Temper_t st_LaserTemper = {
    (const FP32*)&f_TecTR_Vlot,
    (const FP32*)&f_TecTR_Temp,
    91,
    {0.0, 0.0, 0.0, 0.0, 0.0},
    3,
    25.0,
    eLaserTemp
};

Temper_t st_PcbTemper = {
    (const FP32*)&f_PcbTR_Vlot,
    (const FP32*)&f_PcbTR_Temp,
    91,
    {0.0, 0.0, 0.0, 0.0, 0.0},
    3,
    25.0,
    eBoardTemp,
};

FP32 Mod_CalTemper(Temper_t* pst_Temper,FP32 f_Volt)
{
    return s_fx(pst_Temper->af_K,pst_Temper->uch_Order,f_Volt);
}

FP32 Mod_GetTemper(Temper_t* pst_Temper)
{
    INT16U uin_Hex = Bsp_Ltc1867SampleAvg(pst_Temper->e_Channel,10);
    FP32 f_Aver = Bsp_Ltc1867HexToVolt(uin_Hex);
    pst_Temper->f_Temperature = s_fx(pst_Temper->af_K,pst_Temper->uch_Order,f_Aver);
    return pst_Temper->f_Temperature;
}

BOOL Mod_TemperInit(Temper_t* pst_Temper)
{
    /* 计算拟合系数     */
    NiHe1((FP32 *)pst_Temper->pf_Volt,
          (FP32 *)pst_Temper->pf_Temperature,
          91,
          pst_Temper->af_K,
          pst_Temper->uch_Order);
    /* 获取初始温度    */
    Mod_GetTemper(pst_Temper);
    return TRUE;
}
